

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ot.partial &mdash; POT Python Optimal Transport 0.7.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-rendered-html.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ot.sliced" href="ot.sliced.html" />
    <link rel="prev" title="ot.unbalanced" href="ot.unbalanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> POT Python Optimal Transport
          

          
          </a>

          
            
            
              <div class="version">
                0.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">POT: Python Optimal Transport</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick start guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../all.html">API and modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ot.lp.html">ot.lp</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.bregman.html">ot.bregman</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.smooth.html">ot.smooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.gromov.html">ot.gromov</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.optim.html">ot.optim</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.da.html">ot.da</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.gpu.html">ot.gpu</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.dr.html">ot.dr</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.utils.html">ot.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.datasets.html">ot.datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.plot.html">ot.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.stochastic.html">ot.stochastic</a></li>
<li class="toctree-l2"><a class="reference internal" href="ot.unbalanced.html">ot.unbalanced</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ot.partial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples-using-ot-partial-entropic-partial-gromov-wasserstein">Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.entropic_partial_gromov_wasserstein</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples-using-ot-partial-entropic-partial-wasserstein">Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.entropic_partial_wasserstein</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples-using-ot-partial-partial-gromov-wasserstein">Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.partial_gromov_wasserstein</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples-using-ot-partial-partial-wasserstein">Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.partial_wasserstein</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ot.sliced.html">ot.sliced</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">POT Python Optimal Transport</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../all.html">API and modules</a> &raquo;</li>
        
      <li>ot.partial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gen_modules/ot.partial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-ot.partial">
<span id="ot-partial"></span><h1>ot.partial<a class="headerlink" href="#module-ot.partial" title="Permalink to this headline">¶</a></h1>
<p>Partial OT solvers</p>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="ot.partial.entropic_partial_gromov_wasserstein">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">entropic_partial_gromov_wasserstein</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">reg</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">G0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">numItermax</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">1e-07</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#entropic_partial_gromov_wasserstein"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.entropic_partial_gromov_wasserstein" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the partial Gromov-Wasserstein transport between (C1,p) and (C2,q)</p>
<p>The function solves the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}GW = \arg\min_{\gamma} \sum_{i,j,k,l} L(C1_{i,k},C2_{j,l})\cdot
    \gamma_{i,j}\cdot\gamma_{k,l} + reg\cdot\Omega(\gamma)\\\begin{split}s.t.
     \gamma\geq 0 \\
     \gamma 1 \leq a\\
     \gamma^T 1 \leq b\\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\}\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>C1 is the metric cost matrix in the source space</p></li>
<li><p>C2 is the metric cost matrix in the target space</p></li>
<li><p>p and q are the sample weights</p></li>
<li><p>L  : quadratic loss function</p></li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\Omega\)</span>  is the entropic regularization term</dt><dd><p><span class="math notranslate nohighlight">\(\Omega=\sum_{i,j} \gamma_{i,j}\log(\gamma_{i,j})\)</span></p>
</dd>
</dl>
</li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<p>The formulation of the GW problem has been proposed in <a href="#id45"><span class="problematic" id="id1">[12]_</span></a> and the
partial GW in <a href="#id46"><span class="problematic" id="id2">[29]_</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>ns</em><em>)</em>) – Metric cost matrix in the source space</p></li>
<li><p><strong>C2</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>, </em><em>nt</em><em>)</em>) – Metric costfr matrix in the target space</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>,</em><em>)</em>) – Distribution in the source space</p></li>
<li><p><strong>q</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>,</em><em>)</em>) – Distribution in the target space</p></li>
<li><p><strong>reg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – entropic regularization parameter</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Amount of mass to be transported (default: min (<a href="#id3"><span class="problematic" id="id4">|</span></a>p|_1, <a href="#id5"><span class="problematic" id="id6">|</span></a>q|_1))</p></li>
<li><p><strong>G0</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>nt</em><em>)</em><em>, </em><em>optional</em>) – Initialisation of the transportation matrix</p></li>
<li><p><strong>numItermax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Max number of iterations</p></li>
<li><p><strong>tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Stop threshold on error (&gt;0)</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – return log if True</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Print information along iterations</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">199</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C1</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">entropic_partial_gromov_wasserstein</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.12, 0.13, 0.  , 0.  ],</span>
<span class="go">       [0.13, 0.12, 0.  , 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.25, 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.  , 0.25]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">entropic_partial_gromov_wasserstein</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span><span class="mf">0.25</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.02, 0.03, 0.  , 0.03],</span>
<span class="go">       [0.03, 0.03, 0.  , 0.03],</span>
<span class="go">       [0.  , 0.  , 0.03, 0.  ],</span>
<span class="go">       [0.02, 0.02, 0.  , 0.03]])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p>math: <cite>gamma</cite> : (dim_a x dim_b) ndarray – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id7"><span class="brackets">12</span></dt>
<dd><p>Peyré, Gabriel, Marco Cuturi, and Justin Solomon,
“Gromov-Wasserstein averaging of kernel and distance matrices.”
International Conference on Machine Learning (ICML). 2016.</p>
</dd>
<dt class="label" id="id8"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#ot.partial.partial_gromov_wasserstein" title="ot.partial.partial_gromov_wasserstein"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ot.partial.partial_gromov_wasserstein</span></code></a></dt><dd><p>exact Partial Gromov-Wasserstein</p>
</dd>
</dl>
</div>
</dd></dl>

<div class="section" id="examples-using-ot-partial-entropic-partial-gromov-wasserstein">
<h3>Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.entropic_partial_gromov_wasserstein</span></code><a class="headerlink" href="#examples-using-ot-partial-entropic-partial-gromov-wasserstein" title="Permalink to this headline">¶</a></h3>
<div class="sphx-glr-thumbcontainer" tooltip="This example is designed to show how to use the Partial (Gromov-)Wasserstein distance computati..."><div class="figure align-default" id="id41">
<img alt="Partial Wasserstein and Gromov-Wasserstein example" src="../_images/sphx_glr_plot_partial_wass_and_gromov_thumb.png" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="../auto_examples/unbalanced-partial/plot_partial_wass_and_gromov.html#sphx-glr-auto-examples-unbalanced-partial-plot-partial-wass-and-gromov-py"><span class="std std-ref">Partial Wasserstein and Gromov-Wasserstein example</span></a></span><a class="headerlink" href="#id41" title="Permalink to this image">¶</a></p>
</div>
</div><div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.entropic_partial_gromov_wasserstein2">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">entropic_partial_gromov_wasserstein2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">reg</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">G0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">numItermax</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">1e-07</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#entropic_partial_gromov_wasserstein2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.entropic_partial_gromov_wasserstein2" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the partial Gromov-Wasserstein discrepancy between (C1,p) and
(C2,q)</p>
<p>The function solves the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}GW = \arg\min_{\gamma} \sum_{i,j,k,l} L(C1_{i,k},C2_{j,l})\cdot
    \gamma_{i,j}\cdot\gamma_{k,l} + reg\cdot\Omega(\gamma)\\\begin{split}s.t.
     \gamma\geq 0 \\
     \gamma 1 \leq a\\
     \gamma^T 1 \leq b\\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\}\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>C1 is the metric cost matrix in the source space</p></li>
<li><p>C2 is the metric cost matrix in the target space</p></li>
<li><p>p and q are the sample weights</p></li>
<li><p>L  : quadratic loss function</p></li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\Omega\)</span>  is the entropic regularization term</dt><dd><p><span class="math notranslate nohighlight">\(\Omega=\sum_{i,j} \gamma_{i,j}\log(\gamma_{i,j})\)</span></p>
</dd>
</dl>
</li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<p>The formulation of the GW problem has been proposed in <a href="#id47"><span class="problematic" id="id9">[12]_</span></a> and the
partial GW in <a href="#id48"><span class="problematic" id="id10">[29]_</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>ns</em><em>)</em>) – Metric cost matrix in the source space</p></li>
<li><p><strong>C2</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>, </em><em>nt</em><em>)</em>) – Metric costfr matrix in the target space</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>,</em><em>)</em>) – Distribution in the source space</p></li>
<li><p><strong>q</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>,</em><em>)</em>) – Distribution in the target space</p></li>
<li><p><strong>reg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – entropic regularization parameter</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Amount of mass to be transported (default: min (<a href="#id11"><span class="problematic" id="id12">|</span></a>p|_1, <a href="#id13"><span class="problematic" id="id14">|</span></a>q|_1))</p></li>
<li><p><strong>G0</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>nt</em><em>)</em><em>, </em><em>optional</em>) – Initialisation of the transportation matrix</p></li>
<li><p><strong>numItermax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Max number of iterations</p></li>
<li><p><strong>tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Stop threshold on error (&gt;0)</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – return log if True</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Print information along iterations</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>partial_gw_dist</strong> (<em>float</em>) – Gromov-Wasserstein distance</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">199</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C1</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">entropic_partial_gromov_wasserstein2</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">1.87</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id15"><span class="brackets">12</span></dt>
<dd><p>Peyré, Gabriel, Marco Cuturi, and Justin Solomon,
“Gromov-Wasserstein averaging of kernel and distance matrices.”
International Conference on Machine Learning (ICML). 2016.</p>
</dd>
<dt class="label" id="id16"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
</dd></dl>

<div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.entropic_partial_wasserstein">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">entropic_partial_wasserstein</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em>, <em class="sig-param"><span class="n">M</span></em>, <em class="sig-param"><span class="n">reg</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">numItermax</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">stopThr</span><span class="o">=</span><span class="default_value">1e-100</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#entropic_partial_wasserstein"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.entropic_partial_wasserstein" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem
and returns the OT plan</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = arg\min_\gamma &lt;\gamma,M&gt;_F + reg\cdot\Omega(\gamma)\\\begin{split}s.t. \gamma 1 \leq a \\
     \gamma^T 1 \leq b \\
     \gamma\geq 0 \\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\} \\\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\Omega\)</span>  is the entropic regularization term</dt><dd><p><span class="math notranslate nohighlight">\(\Omega=\sum_{i,j} \gamma_{i,j}\log(\gamma_{i,j})\)</span></p>
</dd>
</dl>
</li>
<li><p>a and b are the sample weights</p></li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<p>The formulation of the problem has been proposed in <a class="footnote-reference brackets" href="#id18" id="id17">3</a> (prop. 5)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>,</em><em>)</em>) – Unnormalized histogram of dimension dim_a</p></li>
<li><p><strong>b</strong> (<em>np.ndarray</em><em> (</em><em>dim_b</em><em>,</em><em>)</em>) – Unnormalized histograms of dimension dim_b</p></li>
<li><p><strong>M</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>, </em><em>dim_b</em><em>)</em>) – cost matrix</p></li>
<li><p><strong>reg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Regularization term &gt; 0</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Amount of mass to be transported</p></li>
<li><p><strong>numItermax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Max number of iterations</p></li>
<li><p><strong>stopThr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Stop threshold on error (&gt;0)</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Print information along iterations</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – record log if True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gamma</strong> (<em>(dim_a x dim_b) ndarray</em>) – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">entropic_partial_wasserstein</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.06, 0.02],</span>
<span class="go">       [0.01, 0.  ]])</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id17">3</a></span></dt>
<dd><p>Benamou, J. D., Carlier, G., Cuturi, M., Nenna, L., &amp; Peyré, G.
(2015). Iterative Bregman projections for regularized transportation
problems. SIAM Journal on Scientific Computing, 37(2), A1111-A1138.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#ot.partial.partial_wasserstein" title="ot.partial.partial_wasserstein"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ot.partial.partial_wasserstein</span></code></a></dt><dd><p>exact Partial Wasserstein</p>
</dd>
</dl>
</div>
</dd></dl>

</div>
<div class="section" id="examples-using-ot-partial-entropic-partial-wasserstein">
<h3>Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.entropic_partial_wasserstein</span></code><a class="headerlink" href="#examples-using-ot-partial-entropic-partial-wasserstein" title="Permalink to this headline">¶</a></h3>
<div class="sphx-glr-thumbcontainer" tooltip="This example is designed to show how to use the Partial (Gromov-)Wasserstein distance computati..."><div class="figure align-default" id="id42">
<img alt="Partial Wasserstein and Gromov-Wasserstein example" src="../_images/sphx_glr_plot_partial_wass_and_gromov_thumb.png" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="../auto_examples/unbalanced-partial/plot_partial_wass_and_gromov.html#sphx-glr-auto-examples-unbalanced-partial-plot-partial-wass-and-gromov-py"><span class="std std-ref">Partial Wasserstein and Gromov-Wasserstein example</span></a></span><a class="headerlink" href="#id42" title="Permalink to this image">¶</a></p>
</div>
</div><div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.gwgrad_partial">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">gwgrad_partial</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">T</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#gwgrad_partial"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.gwgrad_partial" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the GW gradient. Note: we can not use the trick in <a href="#id49"><span class="problematic" id="id19">[12]_</span></a>  as
the marginals may not sum to 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>array of shape</em><em> (</em><em>n_p</em><em>,</em><em>n_p</em><em>)</em>) – intra-source (P) cost matrix</p></li>
<li><p><strong>C2</strong> (<em>array of shape</em><em> (</em><em>n_u</em><em>,</em><em>n_u</em><em>)</em>) – intra-target (U) cost matrix</p></li>
<li><p><strong>T</strong> (<em>array of shape</em><em>(</em><em>n_p+nb_dummies</em><em>, </em><em>n_u</em><em>) </em><em>(</em><em>default: None</em><em>)</em>) – Transport matrix</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>gradient</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.array of shape (n_p+nb_dummies, n_u)</p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id20"><span class="brackets">12</span></dt>
<dd><p>Peyré, Gabriel, Marco Cuturi, and Justin Solomon,
“Gromov-Wasserstein averaging of kernel and distance matrices.”
International Conference on Machine Learning (ICML). 2016.</p>
</dd>
</dl>
</dd></dl>

<div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.gwloss_partial">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">gwloss_partial</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">T</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#gwloss_partial"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.gwloss_partial" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the GW loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>array of shape</em><em> (</em><em>n_p</em><em>,</em><em>n_p</em><em>)</em>) – intra-source (P) cost matrix</p></li>
<li><p><strong>C2</strong> (<em>array of shape</em><em> (</em><em>n_u</em><em>,</em><em>n_u</em><em>)</em>) – intra-target (U) cost matrix</p></li>
<li><p><strong>T</strong> (<em>array of shape</em><em>(</em><em>n_p+nb_dummies</em><em>, </em><em>n_u</em><em>) </em><em>(</em><em>default: None</em><em>)</em>) – Transport matrix</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>GW loss</p>
</dd>
</dl>
</dd></dl>

<div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.partial_gromov_wasserstein">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">partial_gromov_wasserstein</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nb_dummies</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">G0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">thres</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">numItermax</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">1e-07</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#partial_gromov_wasserstein"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.partial_gromov_wasserstein" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem
and returns the OT plan</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = arg\min_\gamma &lt;\gamma,M&gt;_F\\\begin{split}s.t. \gamma 1 \leq a \\
     \gamma^T 1 \leq b \\
     \gamma\geq 0 \\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\} \\\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\Omega\)</span> is the entropic regularization term :math:<a href="#id21"><span class="problematic" id="id22">`</span></a>Omega(gamma)</dt><dd><p>=sum_{i,j} gamma_{i,j}log(gamma_{i,j})`</p>
</dd>
</dl>
</li>
<li><p>a and b are the sample weights</p></li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<p>The formulation of the problem has been proposed in <a href="#id50"><span class="problematic" id="id23">[29]_</span></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>ns</em><em>)</em>) – Metric cost matrix in the source space</p></li>
<li><p><strong>C2</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>, </em><em>nt</em><em>)</em>) – Metric costfr matrix in the target space</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>,</em><em>)</em>) – Distribution in the source space</p></li>
<li><p><strong>q</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>,</em><em>)</em>) – Distribution in the target space</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Amount of mass to be transported (default: min (<a href="#id24"><span class="problematic" id="id25">|</span></a>p|_1, <a href="#id26"><span class="problematic" id="id27">|</span></a>q|_1))</p></li>
<li><p><strong>nb_dummies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of dummy points to add (avoid instabilities in the EMD solver)</p></li>
<li><p><strong>G0</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>nt</em><em>)</em><em>, </em><em>optional</em>) – Initialisation of the transportation matrix</p></li>
<li><p><strong>thres</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – quantile of the gradient matrix to populate the cost matrix when 0
(default: 1)</p></li>
<li><p><strong>numItermax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Max number of iterations</p></li>
<li><p><strong>tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – tolerance for stopping iterations</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – return log if True</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Print information along iterations</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – parameters can be directly passed to the emd solver</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gamma</strong> (<em>(dim_a x dim_b) ndarray</em>) – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">199</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C1</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_gromov_wasserstein</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.  , 0.25, 0.  , 0.  ],</span>
<span class="go">       [0.25, 0.  , 0.  , 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.25, 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.  , 0.25]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_gromov_wasserstein</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.25</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.  , 0.  , 0.  , 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.  , 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.25, 0.  ],</span>
<span class="go">       [0.  , 0.  , 0.  , 0.  ]])</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id28"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="examples-using-ot-partial-partial-gromov-wasserstein">
<h3>Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.partial_gromov_wasserstein</span></code><a class="headerlink" href="#examples-using-ot-partial-partial-gromov-wasserstein" title="Permalink to this headline">¶</a></h3>
<div class="sphx-glr-thumbcontainer" tooltip="This example is designed to show how to use the Partial (Gromov-)Wasserstein distance computati..."><div class="figure align-default" id="id43">
<img alt="Partial Wasserstein and Gromov-Wasserstein example" src="../_images/sphx_glr_plot_partial_wass_and_gromov_thumb.png" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="../auto_examples/unbalanced-partial/plot_partial_wass_and_gromov.html#sphx-glr-auto-examples-unbalanced-partial-plot-partial-wass-and-gromov-py"><span class="std std-ref">Partial Wasserstein and Gromov-Wasserstein example</span></a></span><a class="headerlink" href="#id43" title="Permalink to this image">¶</a></p>
</div>
</div><div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.partial_gromov_wasserstein2">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">partial_gromov_wasserstein2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">C1</span></em>, <em class="sig-param"><span class="n">C2</span></em>, <em class="sig-param"><span class="n">p</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nb_dummies</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">G0</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">thres</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">numItermax</span><span class="o">=</span><span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">1e-07</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#partial_gromov_wasserstein2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.partial_gromov_wasserstein2" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem
and returns the partial Gromov-Wasserstein discrepancy</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = arg\min_\gamma &lt;\gamma,M&gt;_F\\\begin{split}s.t. \gamma 1 \leq a \\
     \gamma^T 1 \leq b \\
     \gamma\geq 0 \\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\} \\\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\Omega\)</span>  is the entropic regularization term</dt><dd><p><span class="math notranslate nohighlight">\(\Omega=\sum_{i,j} \gamma_{i,j}\log(\gamma_{i,j})\)</span></p>
</dd>
</dl>
</li>
<li><p>a and b are the sample weights</p></li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<p>The formulation of the problem has been proposed in <a href="#id51"><span class="problematic" id="id29">[29]_</span></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>C1</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>ns</em><em>)</em>) – Metric cost matrix in the source space</p></li>
<li><p><strong>C2</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>, </em><em>nt</em><em>)</em>) – Metric costfr matrix in the target space</p></li>
<li><p><strong>p</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>,</em><em>)</em>) – Distribution in the source space</p></li>
<li><p><strong>q</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>nt</em><em>,</em><em>)</em>) – Distribution in the target space</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Amount of mass to be transported (default: min (<a href="#id30"><span class="problematic" id="id31">|</span></a>p|_1, <a href="#id32"><span class="problematic" id="id33">|</span></a>q|_1))</p></li>
<li><p><strong>nb_dummies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of dummy points to add (avoid instabilities in the EMD solver)</p></li>
<li><p><strong>G0</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>ns</em><em>, </em><em>nt</em><em>)</em><em>, </em><em>optional</em>) – Initialisation of the transportation matrix</p></li>
<li><p><strong>thres</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – quantile of the gradient matrix to populate the cost matrix when 0
(default: 1)</p></li>
<li><p><strong>numItermax</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Max number of iterations</p></li>
<li><p><strong>tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – tolerance for stopping iterations</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – return log if True</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Print information along iterations</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – parameters can be directly passed to the emd solver</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When dealing with a large number of points, the EMD solver may face
some instabilities, especially when the mass associated to the dummy
point is large. To avoid them, increase the number of dummy points
(allows a smoother repartition of the mass over the points).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>partial_gw_dist</strong> (<em>(dim_a x dim_b) ndarray</em>) – partial GW discrepancy</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">199</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C1</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_gromov_wasserstein2</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="go">1.69</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_gromov_wasserstein2</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">0.25</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id34"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
</dd></dl>

<div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.partial_wasserstein">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">partial_wasserstein</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em>, <em class="sig-param"><span class="n">M</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nb_dummies</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#partial_wasserstein"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.partial_wasserstein" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem for the quadratic cost
and returns the OT plan</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = \arg\min_\gamma &lt;\gamma,M&gt;_F\\\begin{split}s.t.
     \gamma\geq 0 \\
     \gamma 1 \leq a\\
     \gamma^T 1 \leq b\\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\}\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><p>a and b are source and target unbalanced distributions</p></li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>,</em><em>)</em>) – Unnormalized histogram of dimension dim_a</p></li>
<li><p><strong>b</strong> (<em>np.ndarray</em><em> (</em><em>dim_b</em><em>,</em><em>)</em>) – Unnormalized histograms of dimension dim_b</p></li>
<li><p><strong>M</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>, </em><em>dim_b</em><em>)</em>) – cost matrix for the quadratic cost</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – amount of mass to be transported</p></li>
<li><p><strong>nb_dummies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em><em>, </em><em>default:1</em>) – number of reservoir points to be added (to avoid numerical
instabilities, increase its value if an error is raised)</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – record log if True</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – parameters can be directly passed to the emd solver</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When dealing with a large number of points, the EMD solver may face
some instabilities, especially when the mass associated to the dummy
point is large. To avoid them, increase the number of dummy points
(allows a smoother repartition of the mass over the points).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>:math:`gamma`</strong> (<em>(dim_a x dim_b) ndarray</em>) – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.1, 0. ],</span>
<span class="go">       [0. , 0.1]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.1, 0. ],</span>
<span class="go">       [0. , 0. ]])</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id35"><span class="brackets">28</span></dt>
<dd><p>Caffarelli, L. A., &amp; McCann, R. J. (2010) Free boundaries in
optimal transport and Monge-Ampere obstacle problems. Annals of
mathematics, 673-730.</p>
</dd>
<dt class="label" id="id36"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#ot.partial.partial_wasserstein_lagrange" title="ot.partial.partial_wasserstein_lagrange"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ot.partial.partial_wasserstein_lagrange</span></code></a></dt><dd><p>Partial Wasserstein with</p>
</dd>
</dl>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">regularization</span></code></p>
<dl class="simple">
<dt><a class="reference internal" href="#ot.partial.entropic_partial_wasserstein" title="ot.partial.entropic_partial_wasserstein"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ot.partial.entropic_partial_wasserstein</span></code></a></dt><dd><p>Partial Wasserstein with a</p>
</dd>
</dl>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">entropic</span></code></p>
</div>
</dd></dl>

</div>
<div class="section" id="examples-using-ot-partial-partial-wasserstein">
<h3>Examples using <code class="docutils literal notranslate"><span class="pre">ot.partial.partial_wasserstein</span></code><a class="headerlink" href="#examples-using-ot-partial-partial-wasserstein" title="Permalink to this headline">¶</a></h3>
<div class="sphx-glr-thumbcontainer" tooltip="This example is designed to show how to use the Partial (Gromov-)Wasserstein distance computati..."><div class="figure align-default" id="id44">
<img alt="Partial Wasserstein and Gromov-Wasserstein example" src="../_images/sphx_glr_plot_partial_wass_and_gromov_thumb.png" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="../auto_examples/unbalanced-partial/plot_partial_wass_and_gromov.html#sphx-glr-auto-examples-unbalanced-partial-plot-partial-wass-and-gromov-py"><span class="std std-ref">Partial Wasserstein and Gromov-Wasserstein example</span></a></span><a class="headerlink" href="#id44" title="Permalink to this image">¶</a></p>
</div>
</div><div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.partial_wasserstein2">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">partial_wasserstein2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em>, <em class="sig-param"><span class="n">M</span></em>, <em class="sig-param"><span class="n">m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nb_dummies</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#partial_wasserstein2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.partial_wasserstein2" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem for the quadratic cost
and returns the partial GW discrepancy</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = \arg\min_\gamma &lt;\gamma,M&gt;_F\\\begin{split}s.t.
     \gamma\geq 0 \\
     \gamma 1 \leq a\\
     \gamma^T 1 \leq b\\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\}\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><p>a and b are source and target unbalanced distributions</p></li>
<li><p>m is the amount of mass to be transported</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>,</em><em>)</em>) – Unnormalized histogram of dimension dim_a</p></li>
<li><p><strong>b</strong> (<em>np.ndarray</em><em> (</em><em>dim_b</em><em>,</em><em>)</em>) – Unnormalized histograms of dimension dim_b</p></li>
<li><p><strong>M</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>, </em><em>dim_b</em><em>)</em>) – cost matrix for the quadratic cost</p></li>
<li><p><strong>m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – amount of mass to be transported</p></li>
<li><p><strong>nb_dummies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em><em>, </em><em>default:1</em>) – number of reservoir points to be added (to avoid numerical
instabilities, increase its value if an error is raised)</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – record log if True</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – parameters can be directly passed to the emd solver</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When dealing with a large number of points, the EMD solver may face
some instabilities, especially when the mass associated to the dummy
point is large. To avoid them, increase the number of dummy points
(allows a smoother repartition of the mass over the points).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>:math:`gamma`</strong> (<em>(dim_a x dim_b) ndarray</em>) – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">0.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id37"><span class="brackets">28</span></dt>
<dd><p>Caffarelli, L. A., &amp; McCann, R. J. (2010) Free boundaries in
optimal transport and Monge-Ampere obstacle problems. Annals of
mathematics, 673-730.</p>
</dd>
<dt class="label" id="id38"><span class="brackets">29</span></dt>
<dd><p>Chapel, L., Alaya, M., Gasso, G. (2020). “Partial Optimal
Transport with Applications on Positive-Unlabeled Learning”.
NeurIPS.</p>
</dd>
</dl>
</dd></dl>

<div class="sphx-glr-clear"></div><dl class="py function">
<dt id="ot.partial.partial_wasserstein_lagrange">
<code class="sig-prename descclassname">ot.partial.</code><code class="sig-name descname">partial_wasserstein_lagrange</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span></em>, <em class="sig-param"><span class="n">b</span></em>, <em class="sig-param"><span class="n">M</span></em>, <em class="sig-param"><span class="n">reg_m</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">nb_dummies</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ot/partial.html#partial_wasserstein_lagrange"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ot.partial.partial_wasserstein_lagrange" title="Permalink to this definition">¶</a></dt>
<dd><p>Solves the partial optimal transport problem for the quadratic cost
and returns the OT plan</p>
<p>The function considers the following problem:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = \arg\min_\gamma &lt;\gamma,(M-\lambda)&gt;_F\\\begin{split}s.t.
     \gamma\geq 0 \\
     \gamma 1 \leq a\\
     \gamma^T 1 \leq b\\
     1^T \gamma^T 1 = m \leq \min\{\|a\|_1, \|b\|_1\}\end{split}\end{aligned}\end{align} \]</div>
<p>or equivalently (see Chizat, L., Peyré, G., Schmitzer, B., &amp; Vialard, F. X.
(2018). An interpolating distance between optimal transport and Fisher–Rao
metrics. Foundations of Computational Mathematics, 18(1), 1-44.)</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\gamma = \arg\min_\gamma &lt;\gamma,M&gt;_F  + \sqrt(\lambda/2)
(\|\gamma 1 - a\|_1 + \|\gamma^T 1 - b\|_1)\\\begin{split}s.t.
     \gamma\geq 0 \\\end{split}\end{aligned}\end{align} \]</div>
<p>where :</p>
<ul class="simple">
<li><p>M is the metric cost matrix</p></li>
<li><p>a and b are source and target unbalanced distributions</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> is the lagragian cost. Tuning its value allows attaining
a given mass to be transported m</p></li>
</ul>
<p>The formulation of the problem has been proposed in <a href="#id52"><span class="problematic" id="id39">[28]_</span></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>,</em><em>)</em>) – Unnormalized histogram of dimension dim_a</p></li>
<li><p><strong>b</strong> (<em>np.ndarray</em><em> (</em><em>dim_b</em><em>,</em><em>)</em>) – Unnormalized histograms of dimension dim_b</p></li>
<li><p><strong>M</strong> (<em>np.ndarray</em><em> (</em><em>dim_a</em><em>, </em><em>dim_b</em><em>)</em>) – cost matrix for the quadratic cost</p></li>
<li><p><strong>reg_m</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Lagragian cost</p></li>
<li><p><strong>nb_dummies</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em><em>, </em><em>default:1</em>) – number of reservoir points to be added (to avoid numerical
instabilities, increase its value if an error is raised)</p></li>
<li><p><strong>log</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – record log if True</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – parameters can be directly passed to the emd solver</p></li>
<li><p><strong>warning::</strong> (<em>.</em>) – When dealing with a large number of points, the EMD solver may face
some instabilities, especially when the mass associated to the dummy
point is large. To avoid them, increase the number of dummy points
(allows a smoother repartition of the mass over the points).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gamma</strong> (<em>(dim_a x dim_b) ndarray</em>) – Optimal transportation matrix for the given parameters</p></li>
<li><p><strong>log</strong> (<em>dict</em>) – log dictionary returned only if <cite>log</cite> is <cite>True</cite></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein_lagrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.1, 0. ],</span>
<span class="go">       [0. , 0.1]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partial_wasserstein_lagrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">reg_m</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([[0.1, 0. ],</span>
<span class="go">       [0. , 0. ]])</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id40"><span class="brackets">28</span></dt>
<dd><p>Caffarelli, L. A., &amp; McCann, R. J. (2010) Free boundaries in
optimal transport and Monge-Ampere obstacle problems. Annals of
mathematics, 673-730.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#ot.partial.partial_wasserstein" title="ot.partial.partial_wasserstein"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ot.partial.partial_wasserstein</span></code></a></dt><dd><p>Partial Wasserstein with fixed mass</p>
</dd>
</dl>
</div>
</dd></dl>

<div class="sphx-glr-clear"></div></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ot.sliced.html" class="btn btn-neutral float-right" title="ot.sliced" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ot.unbalanced.html" class="btn btn-neutral float-left" title="ot.unbalanced" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2020, Rémi Flamary, Nicolas Courty

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>